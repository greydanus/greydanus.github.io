<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Optimizing a Wing</title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="A science blog by Sam Greydanus">
    <link rel="canonical" href="http://localhost:4000/assets/2020-07-30-optimizing-a-wing/">
    <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Natural Intelligence posts" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/style.css">

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-72311215-6', 'auto');
      ga('send', 'pageview');

    </script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

</head>


    <body>

    <header class="site-header">

  <div class="wrap">

    <div style="float:left; margin-top:11px; margin-right:10px;">
    <img src="/assets/oak.png" width="50px">
    </div>

    <div style="float:left; margin-top:4px; margin-right:10px;">
      <a class="site-title" style="padding-top:0px; padding-bottom:0px;" href="/ ">Natural Intelligence</a>
      <p style="padding-bottom:6px; font-size:14px">A science blog by Sam Greydanus</p>
    </div>

    <!-- <a class="site-title" style="padding-top:8px; font-size:28px" href="/ ">Natural Intelligence</a> -->
    
    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
           viewBox="0 0 18 15" enable-background="new 0 0 18 15" xml:space="preserve">
          <path fill="#505050" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0
            h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#505050" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484
            h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#505050" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0
            c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger" style="margin-bottom:0px; padding-top:10px; font-size:13px">
<!--         <a class="page-link" href="/ ">Home</a> -->
<!--         
          <a class="page-link" href="/assets/2020-07-28-desire-to-fly/">The Desire to Fly</a>
        
          <a class="page-link" href="/assets/2020-07-29-stepping-stones/">The Stepping Stones of Flight</a>
        
          <a class="page-link" href="/assets/2020-07-30-optimizing-a-wing/">Optimizing a Wing</a>
        
          
        
          <a class="page-link" href="/papers/">Interesting papers</a>
         -->
        <a class="page-link" style="margin-bottom: 0px; padding-bottom:0px;" href="https://greydanus.github.io/about.html">About me</a>
      </div>
    </nav>
  </div>

</header>


    <div class="page-content">
      <div class="wrap">
      <div class="post">

  <header class="post-header">
    <h1>Optimizing a Wing</h1>
    <p class="meta">Jul 30, 2020 ‚Ä¢ Sam Greydanus</p>
  </header>

  <article class="post-content">
  <div>
	<style>
		#linkbutton:link, #linkbutton:visited {
		  background-color: rgb(180,180,180);
		  border-radius: 4px;
		  color: white;
		  padding: 6px 0px;
		  width: 150px;
		  text-align: center;
		  text-decoration: none;
		  display: inline-block;
		  text-transform: uppercase;
		  font-size: 13px;
		  margin: 8px;
		}

		#linkbutton:hover, #linkbutton:active {
		  background-color: rgba(160,160,160);
		}

		.playbutton {
		  background-color: rgba(0, 153, 51);
		  /*background-color: rgba(255, 130, 0);*/
		  border-radius: 4px;
		  color: white;
		  padding: 3px 8px;
		  /*width: 60px;*/
		  text-align: center;
		  text-decoration: none;
		  text-transform: uppercase;
		  font-size: 12px;
		  /*display: block;*/
		  /*margin-left: auto;*/
		  margin: 8px 0px;
		  margin-right: auto;
		  min-width:80px;
		}
	</style>
</div>

<div class="imgcap_noborder" style="display: block; margin-left: auto; margin-right: auto; text-align:left; width:70%">
    <img alt="" src="/assets/optimizing-a-wing/wing_shape.png" onclick="toggleWingShape()" width="300px" id="wingShapeImage" />
    <img alt="" src="/assets/optimizing-a-wing/wing_flow.png" onclick="toggleWingFlow()" width="300px" id="wingFlowImage" />
	<div class="thecap" style="text-align:left"><b>Figure 1:</b> We simulate a wind tunnel, place a rectangular occlusion in it, and then use gradient descent to turn it into a wing. <p style="color:grey; display:inline;">[The images above are videos. Click them to pause or play.]</p></div>
</div>

<div style="display: block; margin-left: auto; margin-right: auto; width:100%; text-align:center;">
	<a href="" id="linkbutton" target="_blank">Read the paper</a>
	<a href="https://colab.research.google.com/drive/1RTsSyr7B3THKVGp_44Oyh7rxBriOHzJ7" id="linkbutton" target="_blank">Run in browser</a>
	<a href="https://github.com/greydanus/optimize_wing" id="linkbutton" target="_blank">Get the code</a>
</div>

<p>Legos are a wonderful meta-toy in that they represent the potential for a near-infinite number of toys depending on how you assemble them. Each brick has structure. But each brick is only interesting to the extent that it can combine with other bricks to form new and more complex structures. So in order to enjoy Legos, you have to figure out how they fit together and come up with a clever way of making the particular toy you have in mind. The open-ended design of Lego bricks lets you build nearly anything you want and this ends up being incredibly satisfying.</p>

<p>As an adult, I find myself appreciating the same things in the physical world that I appreciated in Legos when I was younger. The beauty of the physical world is its simplicity. It‚Äôs a special kind of simplicity that, like Lego bricks, allows intricate structures to form on many levels. You see this everywhere you look in nature, across all scales of space and time. In the fractal design of a seashell or the intricate polities of a coral. In the convection of a teacup or the circulation of the atmosphere. And it‚Äôs this simple structure that determines the shape and behavior of even the most complicated flying machines.</p>

<p>To see this more clearly, we are going to start from the basic physical laws of airflow and use them to derive the shape of a wing.<sup id="fnref:fn1" role="doc-noteref"><a href="#fn:fn1" class="footnote">1</a></sup> Since we‚Äôre using so few assumptions, the wing shape we come up with will be as fundamental as the physics of the air that swirls around it. This is pretty fundamental. In fact, if an alien species started building flying machines on another planet, my guess is that they would converge on a similar shape.</p>

<h3 id="navier-stokes">Navier-Stokes</h3>

<p>We will begin this journey with the <a href="https://www.britannica.com/science/Navier-Stokes-equation">Navier-Stokes equation</a>, which sums up pretty much everything we know about fluid dynamics. It describes how tiny fluid parcels interact with their neighbors. The process of solving fluid dynamics problems comes down to writing out this equation and then deciding which terms we can safely ignore. In our case, we‚Äôd like to simulate the flow of air through a wind tunnel so that we can evaluate various wing shapes. Since the pressure differences across a wind tunnel are small, one of the first assumptions we can make is that the air is incompressible. This lets us use the <a href="https://en.wikipedia.org/wiki/Navier%E2%80%93Stokes_equations#Incompressible_flow">incompressible form</a> of the Navier-Stokes equation:</p>

<p><span id="longEqnWithSmallScript_A" style="display:block; margin-left:auto;margin-right:auto;text-align:center;">
\(\underbrace{\frac{\partial \mathbf{u}}{\partial t}}_{\text{velocity update}} ~=~ - \underbrace{(\mathbf{u} \cdot \nabla)\mathbf{u}}_{\text{self-advection}} ~+~ \underbrace{\nu \nabla^2 \mathbf{u}}_{\text{viscous diffusion}} \\
~+~ \underbrace{f}_{\text{velocity $\uparrow$ due to forces}}\)
</span>
<span id="longEqnWithLargeScript_A" style="display:block; margin-left:auto;margin-right:auto;text-align:center;">
\(\underbrace{\frac{\partial \mathbf{u}}{\partial t}}_{\text{velocity update}} ~=~ - \underbrace{(\mathbf{u} \cdot \nabla)\mathbf{u}}_{\text{self-advection}} ~+~ \underbrace{\nu \nabla^2 \mathbf{u}}_{\text{viscous diffusion}} ~+~ \underbrace{f}_{\text{velocity $\uparrow$ due to forces}}\)
</span></p>

<p>Another term we can ignore is viscous diffusion. Viscous diffusion describes how fluid parcels distribute their momenta due to ‚Äústicky‚Äù interactions with their neighbors. We would say that a fluid with high viscosity is ‚Äúthick‚Äù: common examples include molasses and motor oil. Even though air is much ‚Äúthinner‚Äù, viscous interactions still cause a layer of slow-moving air to form along the surface of an airplane wing. However, we can ignore this boundary layer because its contribution to the aerodynamics of the wing is small compared to that of self-advection.</p>

<p>The final term we can ignore is the forces term, as there will be no external forces on the air once it enters the tunnel. And so we are left with but a hair of the original Navier-Stokes hairball:</p>

\[\underbrace{\frac{\partial \mathbf{u}}{\partial t}}_{\text{velocity update}} = \underbrace{- (\mathbf{u} \cdot \nabla)\mathbf{u}}_{\text{self-advection ("velocity follows itself")}}\]

<p>This simple expression describes the effects that really dominate wind tunnel physics. It tells us that <em>the change in velocity over time is due to the fact that velocity follows itself.</em></p>

<p>So the entire simulation comes down to two simple rules:</p>
<ul>
	<li>
		‚Ä¢ Rule 1: Velocity follows itself <div id="advection_info_toggle" onclick="hideShowAdvection()" style="cursor: pointer;display:inline">(+)</div>
		<ul>
		<div id="advection_info" style="display: none;"><i>The technical term for this effect is <b>self-advection</b>. Advection is when a field, say, of smoke, is moved around by the velocity of a fluid. Self-advection is a special case where the field in question is a velocity field. In principle, a self-advection step is as simple as moving the velocity field according to ‚Äúx1 = v0*delta_t + x0‚Äù at every point on the grid. We can simulate advection over time by repeating this over and over again ‚Äì this is called Euler integration. The problem with Euler integration is that when you do it on a grid, small numerical errors can accumulate into big ones. There's a related approach called Backward Euler integration which mitigates these errors. In Backward Euler, we use the final velocity rather than the initial velocity to perform advection: the update becomes "x1 = v1*delta_t + x0" instead. Page 8 of <a href="https://drive.google.com/file/d/1upKFdtnM0xcTVxNsPHI1KCvmcanAJheL/view?usp=sharing">this paper</a> gives an intuition for why this is a good idea.</i></div>
		</ul>
	</li>
	<li>
		<!-- <b>Rule 1: Velocity follows itself</b> -->
		‚Ä¢ Rule 2: Volume is conserved <div id="projection_info_toggle" onclick="hideShowProjection()" style="cursor: pointer;display:inline">(+)</div>
		<ul>
		<div id="projection_info" style="display: none;"><i>This rule comes from our "incompressibility" assumption. The process of enforcing it is called <b>projection</b>. Since volume is conserved, fluid parcels can only move into positions that their neighbors have recently vacated. This puts a strong constraint on our simulation's velocity field: it needs to be "volume-conserving" or "incompressible". Fortunately, Helmholtz‚Äôs theorem tells us that any vector field can be decomposed into an incompressible field and a gradient field, as shown here (taken from <a href="https://drive.google.com/file/d/1upKFdtnM0xcTVxNsPHI1KCvmcanAJheL/view?usp=sharing">this paper</a>):
			<div class="imgcap_noborder" style="display: block; margin-left: auto; margin-right: auto; width:70%">
				<img src="/assets/optimizing-a-wing/decomposition.png" style="width:100%" />
			</div>
		One way to make our velocity field incompressible is to find the gradient field and subtract it from the original field, effectively projecting our velocity field onto a volume-conserving manifold. We can solve for the gradient field by using a few iterations of the <a href="https://en.wikipedia.org/wiki/Gauss%E2%80%93Seidel_method">Gauss-Seidel method</a> to solve <a href="https://en.wikipedia.org/wiki/Poisson%27s_equation">Poisson's equation</a>.</i>
		</div>
		</ul>
	</li>
</ul>

<h3 id="representing-the-wing">Representing the Wing</h3>

<div>
<div style="display:inline">Now that we‚Äôve simplified wind tunnel physics as much as possible, it's time to talk about how to add a wing shape. The wing is an internal boundary, or ‚Äúocclusion‚Äù of the flow. A good way to represent an occlusion is with a mask of zeros and ones. But since the goal of our wind tunnel is to try out different wing shapes, we need our wing to be continuously deformable. So let's allow our mask to take on continuous values between zero and one. Now our wing is semi-permeable in proportion to its mask values.</div> <div id="filter_info_toggle" onclick="hideShowFilter()" style="cursor: pointer;display:inline">(+)</div>
</div>

<div id="filter_info" style="display: none;"><i><b>A note on filtering.</b> In practice, the wing is still not quite continuously deformable. Big differences in the mask at neighboring grid points can lead to sharp boundary conditions and non-physical airflows around the mask. One way to reduce this effect is to apply a Gaussian filter to the flow around the edge of the mask so as to prevent these grid-level pathologies. This same technique is used to avoid grid-scale artifacts in <a href="https://doi.org/10.1007/s00158-010-0594-7">topology optimization</a>, <a href="https://web.stanford.edu/group/ctr/ResBriefs03/gullbrand.pdf">large</a> <a href="https://doi.org/10.1063/1.3485774">eddy simulations</a>, and <a href="https://graphics.stanford.edu/courses/cs468-03-fall/Papers/Levin_MovingLeastSquares.pdf">3D graphics</a>.</i></div>

<div class="imgcap" style="display: block; margin-left: auto; margin-right: auto; width:99.9%">
  <div style="width:19.5%; min-width:150px; display: inline-block; vertical-align: top;">
    <img src="/assets/optimizing-a-wing/mask/mask_0.00.png" style="width:100%" />
    <div style="text-align: left;">Mask = 0.0</div>
  </div>
    <div style="width:19.5%; min-width:150px; display: inline-block; vertical-align: top;">
    <img src="/assets/optimizing-a-wing/mask/mask_0.05.png" style="width:100%" />
    <div style="text-align: left;">Mask = 0.05</div>
  </div>
    <div style="width:19.5%; min-width:150px; display: inline-block; vertical-align: top;">
    <img src="/assets/optimizing-a-wing/mask/mask_0.12.png" style="width:100%" />
    <div style="text-align: left;">Mask = 0.12</div>
  </div>
  <div style="width:19.5%; min-width:150px; display: inline-block; vertical-align: top;">
    <img src="/assets/optimizing-a-wing/mask/mask_0.50.png" style="width:100%" />
    <div style="text-align: left;">Mask = 0.5</div>
  </div>
  <div style="width:19.5%; min-width:150px; display: inline-block; vertical-align: top;">
    <img src="/assets/optimizing-a-wing/mask/mask_1.00.png" style="width:100%" />
    <div style="text-align: left;">Mask = 1.0</div>
  </div>
</div>

<p>We have succeeded in simulating a wind tunnel in just about 100 lines of code.<sup id="fnref:fn2" role="doc-noteref"><a href="#fn:fn2" class="footnote">2</a></sup> Now let‚Äôs use it to optimize a wing. There are many qualities that one could look for in a good wing, but let‚Äôs begin with the most straightforward: we want it to convert horizontal air velocity into upward force as efficiently as possible. We can measure this ability using something called the lift-drag ratio, where ‚Äúlift‚Äù measures the wing‚Äôs upward force and ‚Äúdrag‚Äù measures the wing‚Äôs efficiency. Since ‚Äúchange in downward airflow‚Äù in the tunnel is proportional to the upward force on the wing, we can use it as a proxy for lift. Likewise, ‚Äúchange in rightward airflow‚Äù is a good proxy for drag.</p>

\[\begin{align}
    \frac{\text{lift}}{\text{drag}} &amp;= \frac{-\text{change in downward airflow}}{\text{change in rightward airflow}}\\
    &amp;= \frac{-\big ( v_y(t)-v_y(0) \big )}{v_x(t)-v_x(0)}
\end{align}\]

<h3 id="optimization">Optimization</h3>

<div>
<div style="display:inline">At this point, we have identified physical constraints and an objective. In the big picture, our goal is to change the wing mask so as to increase its overall lift-drag ratio as much as possible. The way to do this is to follow the gradient of the objective with respect to the wing shape. Luckily for us, there is a clever tool called Autograd which can compute that gradient analytically. Once we have the gradient, all we have to do is take incremental steps in that direction until we don‚Äôt see additional improvements. When this process of gradient ascent is over, we can hope to see a wing.</div> <div id="autograd_info_toggle" onclick="hideShowAutograd()" style="cursor: pointer;display:inline">(+)</div>
</div>

<div id="autograd_info" style="display: none;"><i><b>A note on Autograd.</b> Amazingly, every mathematical operation we've described so far ‚Äì from the wing masking operation to the advection and projection functions, to the lift-drag ratio ‚Äì is differentiable. This is why we can use Autograd to compute the analytic gradient. Autograd uses <a href="https://en.wikipedia.org/wiki/Automatic_differentiation">automatic differentiation</a>, closely related to the <a href="http://www.dolfin-adjoint.org/en/latest/documentation/maths/2-problem.html">adjoint method</a>, to propagate gradient information backwards through the simulation until it reaches the parameters of the wing mask. We can do all of this in a one-line function transformation: <code>grad_fn = autograd.value_and_grad(get_lift_drag_ratio)</code>.</i></div>

<p>So let‚Äôs review. Our goal is to simulate a wind tunnel and use it to derive a wing shape. We began by writing down the general Navier-Stokes equation and eliminating irrelevant terms: all of them but self-advection. Next, we figured out how to put a continuously-deformable occlusion in the center of the tunnel. Finally, we wrote down an equation for what a good wing should do and discussed how to optimize it. Now it is time to put everything together in about 200 lines of code and run the optimization to see what we get‚Ä¶</p>

<div class="imgcap_noborder" style="display: block; margin-left: auto; margin-right: auto; width:40%; min-width: 300px">
	<img alt="" src="/assets/optimizing-a-wing/wing.png" onclick="toggleBasicWing()" id="basicWing" />
	<p style="color:grey; display:inline;">[Click to pause or play.]</p>
</div>

<p>Sure enough, we get a beautiful little wing üòä. Of all possible shapes, this is the very best one for creating efficient lift in our wind tunnel. This wing is definitely a toy solution since our simulation is coarse and not especially accurate. However, with a few simple improvements, we‚Äôd be able to design a real airplane wing this way.</p>

<p>We‚Äôd just need to:</p>
<ol>
  <li>Simulate in 3D instead of 2D</li>
  <li>Use a mesh parameterization instead of a grid</li>
  <li>Make the flow laminar and compressible</li>
</ol>

<p>Aside from these improvements, the overall principle is much the same.<sup id="fnref:fn14" role="doc-noteref"><a href="#fn:fn14" class="footnote">3</a></sup> In both cases, we write down some words and symbols, turn them into code, and use the code to shape our wing. The fact that we can do all of this without ever building a physical wing makes it feel a bit like magic. But the proof is in the pudding, for when we <a href="http://aero-comlab.stanford.edu/Papers/jameson-cincin-pm.pdf#page=36">put these wings on airplanes</a> and trust them with our lives, they carry us safely to our destinations.<sup id="fnref:fn3" role="doc-noteref"><a href="#fn:fn3" class="footnote">4</a></sup></p>

<p>Just like the real wind tunnels of the 1900‚Äôs, these simulated wind tunnels need to go through lots of debugging before we can trust them. In fact, while building this demo I discovered all sorts of ways that things could go wrong. Some of the most amusing bloopers happened while I was trying to get the optimization code dialed in.</p>

<div class="imgcap_noborder" style="display: block; margin-left: auto; margin-right: auto; width:100%">
	<img src="/assets/optimizing-a-wing/sim_bloopers.png" style="width:100%" />
</div>

<p>Several of these bloopers are just plain dreadful. But others are reasonable - if unexpected - solutions. I think the ‚Äútwo wing‚Äù solution is particularly fun. It was entirely unexpected and yet there‚Äôs a good precedent for it, in that biplanes have the same two-wing structure. This surprising result is a consequence of our demo‚Äôs extreme simplicity. This simplicity makes the design space more open-ended and permits all sorts of interesting accidents to occur.</p>

<h3 id="the-manifold-of-solutions">The Manifold of Solutions</h3>

<p>In fact, the problem of designing a good wing is so open-ended that there are actually many valid solutions. Sometimes we‚Äôll care more about a wing that is optimal at high speeds and other times we‚Äôll want one that‚Äôs optimal at low speeds. Maybe we‚Äôll want a particularly thick wing so as to accommodate a large fuselage. Or, we might want to keep the mass of the wing low so as to reduce weight. In order to take all these possibilities into account, perhaps we should try solving for a whole manifold of solutions.</p>

<div class="imgcap_noborder" style="display: block; margin-left: auto; margin-right: auto; width:60%; min-width: 300px">
	<img src="/assets/optimizing-a-wing/sim_manifold.png" style="width:100%" />
</div>

<p>Most people won‚Äôt be shocked by the idea that design problems are open-ended. However, there are many ways in which we ignore the open-ended nature of the real world. We do this in order to turn complicated problems into simpler ones. Some examples incude measuring academic ability by test scores or social influence by followers.</p>

<p>But nature is different. Nature takes a consummate joy in variation. It‚Äôs easy to see this by looking at the remarkable variety of wing shapes in birds.<sup id="fnref:fn4" role="doc-noteref"><a href="#fn:fn4" class="footnote">5</a></sup> Some birds have wings with low aspect ratios that enable and quick, agile flight patterns. Others, like the albatross, have high aspect ratios for extreme efficiency. Still others, like the common raven, are good all-around fliers. This speciation is beginning to occur in modern aircraft as well. We have surveillance planes built for speed and stealth, short-winged bush planes built for maneuverability, and massive commercial airliners built for efficiency.<sup id="fnref:fn5" role="doc-noteref"><a href="#fn:fn5" class="footnote">6</a></sup></p>

<div class="imgcap" style="display: block; margin-left: auto; margin-right: auto; width:99.9%">
  <div style="width:36.4815%; min-width:200px; display: inline-block; vertical-align: top;">
    <img src="/assets/optimizing-a-wing/bird_shapes.png" style="width:100%" />
    <div style="text-align: left;">Bird species plotted by wing pointedness (horizontal axis) and wingtip convexity (vertical axis). Each point represents a species; seven species are highlighted and named as examples.</div>
  </div>
  <div style="width:62.073%; min-width:300px; display: inline-block; vertical-align: top;">
    <img src="/assets/optimizing-a-wing/norberg2002.png" style="width:100%" />
    <div style="text-align:left;">Aspect ratio vs. wing loading index, made independent of size, in some birds, airplanes, a hang-glider, a butterfly, and a maple seed. Bats have a similar aspect ratio range compared to birds but slightly lower wing loadings because their tail membrane area is integrated in the wing area.</div>
  </div>
</div>

<p>Perhaps less intuitively, a single bird is capable of a huge range of wing shapes. The falcon, for example, uses different wing shapes for soaring, diving, turning, and landing. Its wings are not a static things, but rather deformable, dynamic objects which are constantly adapting to their surroundings. And once again, we are beginning to see the same thing happen in modern aircrafts. The Boeing 747, for example, has a triple-slotted wing design that lets pilots reconfigure the overall wing shape for takeoff, cruising, and landing.</p>

<div class="imgcap" style="display: block; margin-left: auto; margin-right: auto; width:99.9%">
  <div style="width:55%; min-width:250px; display: inline-block; vertical-align: top;">
    <img src="/assets/optimizing-a-wing/bird_morph.png" style="width:100%" />
  </div>
  <div style="width:44.3%; min-width:250px; display: inline-block; vertical-align: top;">
    <img src="/assets/optimizing-a-wing/plane_morph.png" style="width:100%" />
  </div>
</div>

<h3 id="quality-diversity">Quality-Diversity</h3>

<p>In machine learning, the idea that some problems have more than one solution is called <i>open-endedness</i>. In response to this idea, researchers have developed a variety of <a href="https://quality-diversity.github.io/">quality-diversity</a> algorithms which solve for a <a href="https://en.wikipedia.org/wiki/Pareto_efficiency">pareto frontier</a> of diverse but equally-valid solutions. This is still a fledgling area of research (ha), but notable works include MAP-elites<sup id="fnref:fn6" role="doc-noteref"><a href="#fn:fn6" class="footnote">7</a></sup> <sup id="fnref:fn7" role="doc-noteref"><a href="#fn:fn7" class="footnote">8</a></sup> and POET.<sup id="fnref:fn8" role="doc-noteref"><a href="#fn:fn8" class="footnote">9</a></sup> Jeff Clune has a good discussion of these things in his <a href="https://icml.cc/media/Slides/icml/2019/halla(10-09-15)-10-09-15-4336-recent_advances.pdf">ICML 2019 tutorial</a>.</p>

<p>The same ideas have begun to percolate through the reinforcement learning literature as well. A number of recent papers have examined the effects of self-play and league play on how RL agents learn.<sup id="fnref:fn15" role="doc-noteref"><a href="#fn:fn15" class="footnote">10</a></sup> <sup id="fnref:fn9" role="doc-noteref"><a href="#fn:fn9" class="footnote">11</a></sup> <sup id="fnref:fn10" role="doc-noteref"><a href="#fn:fn10" class="footnote">12</a></sup> It turns out that, in order to find a stable <a href="https://en.wikipedia.org/wiki/Nash_equilibrium">Nash equilibrium</a>, one must have a diverse set of agents that continually exploit each others‚Äô weaknesses. The core idea is that when you make a population of agents (and their objectives) more diverse, the best-performing agents in that population tend to become more robust.</p>

<p>Another way to look at open-endedness is that it allows you to change your environment as you pursue your objective. And in changing your environment, you may alter your original objective, producing a continual cycle of new environments and objectives. You can see this in 20th century aeronautics: the engineers who figured out how to fly at subsonic speeds earned themselves an entirely new challenge ‚Äì that of designing airplanes in the supersonic regime. This bootstrapping effect, where problems and solutions feed off one another, produces an endless frontier of new problems worth exploring.<sup id="fnref:fn11" role="doc-noteref"><a href="#fn:fn11" class="footnote">13</a></sup></p>

<div class="imgcap" style="display: block; margin-left: auto; margin-right: auto; width:99.9%">
  <div style="width:62.279%; min-width:300px; display: inline-block; vertical-align: top;">
    <img src="/assets/optimizing-a-wing/map-elites.png" style="width:100%" />
    <div style="text-align: left;">Visualizing a large population of soft robots trained on a locomotion task. Each pixel corresponds to a different robot and its color corresponds to relative performance (brighter is better). Each voxel of the robot can be either bone, muscle, or empty. Some example robot shapes are plotted around the edges of the figure. Figure from the <a href="https://arxiv.org/abs/1504.04909">MAP-Elites paper</a>.</div>
  </div>
  <div style="width:35.28%; min-width:200px; display: inline-block; vertical-align: top;">
    <img src="/assets/optimizing-a-wing/starcraft.png" style="width:100%" />
    <div style="text-align:left;">A population of RL agents trained to play StarCraft. The MaNa agent competed against <a href="https://liquipedia.net/starcraft2/MaNa">MaNa</a>. Dot sizes represent probability of being selected to play against MaNa agent. Fig. is from <a href="https://deepmind.com/blog/article/alphastar-mastering-real-time-strategy-game-starcraft-ii">AlphaStar article</a>.</div>
  </div>
<!--   <div style="width:15.1%; min-width:150px; display: inline-block; vertical-align: top;">
    <img src="/assets/optimizing-a-wing/rock-paper-scissors.png" style="width:100%">
    <div style="text-align:left;">The progression of notable airfoils developed by national labs between 1915 and 1945.</div>
  </div> -->
</div>

<p>That much novelty is a good thing, but it‚Äôs also dangerous. If your aim changes too often, it‚Äôs easy to forget what you‚Äôve learned and begin chasing your own tail. In machine learning, this sort of thing happens when a neural network ‚Äú<a href="https://en.wikipedia.org/wiki/Catastrophic_interference">catastrophically forgets</a>‚Äù one skill while trying to learn another. In engineering, people call it ‚Äúreinventing the wheel.‚Äù Regardless, it‚Äôs preferable to aim at something new and better. So how can we avoid wandering back into the past?</p>

<!-- That much novelty is a good thing, but it‚Äôs also dangerous. If your aim changes too often, it's easy to forget what you've learned and begin chasing your own tail. In the final sentence of _The Great Gatsby_, the narrator muses: "So we beat on, boats against the current, borne back ceaselessly into the past." This lyrical conclusion conceals a subtle warning: if you're not careful, the past will repeat itself. This is not good for us. And it's not good for optimizing machine learning models or wing designs. We'd prefer to continually aim at something new and inspiring. So how can we avoid wandering back into the past? -->

<h3 id="the-desire-to-fly">The Desire to Fly</h3>

<p>The answer is that the optimization function is never the full story. When we write down an optimization function like we did for the wing demo, our minds have a vague desire to form a wing shape. Behind that, there is a desire to fly, and behind that ‚Äì perhaps ‚Äì a desire for freedom, and behind that, what? The paradox of an objective function is that it always seems to have a grander desire behind it. And the deeper desires don‚Äôt change as quickly. Even as the early aviators progressed from wingsuits to gliders to planes, they retained the same fundamental desire for flight. As they shaped technology, they shaped their particular desires. And as they shaped their particular desires, they shaped themselves. But it was the desire to fly that put all of this into motion.</p>

<p>Indeed, the desire to fly shaped the early aviators as much as they, in turn, shaped the world. In pursuit of flight, they had to discipline themselves and spend years perfecting their craft. They had to become pragmatists to ensure that their lofty dreams would survive. There is a sense in which you and I must do the same. All of us are shaped by the desires we aim at. Our prefrontal cortex is constantly inhibiting or exciting lower brain regions. Each of these regions involves a different set of desires: food, sleep, sex, exercise, safety, curiosity, power, affection, and more. We can choose which of these to aim at. It‚Äôs a core part of free will, for in choosing which desires to act on, we choose the person we will become.</p>

<div class="imgcap_noborder">
  <img src="/assets/desire-to-fly/hummingbird.png" style="width:20%;min-width:150px;" />
</div>

<p>Like a hermit crab, we are born with desires that our body cannot satisfy, and thus we must venture out into the world, build things, and make them part of who we are. But we differ from the hermit crab in one important way. While he seeks out a shell because he wants safety, we seek flight because we want freedom, adventure, and change. We are not trying to stay the same, but rather we are aiming for a future that is different and better. Freedom, adventure, and change is what made us a flying species in the first place and it will propel us even higher tomorrow. So long as we have the desire to fly.</p>

<!-- So we beat on, wings angled into the wind, borne ceaselessly into the future. -->

<h2 id="footnotes">Footnotes</h2>

<script language="javascript">
	function toggleWingShape() {

		path = document.getElementById("wingShapeImage").src
	    if (path.split('/').pop() == "wing_shape.png") {
	        document.getElementById("wingShapeImage").src = "/assets/optimizing-a-wing/wing_shape.gif";
	    } else {
	        document.getElementById("wingShapeImage").src = "/assets/optimizing-a-wing/wing_shape.png";
	    }
	}
</script>

<script language="javascript">
	function toggleWingFlow() {

		path = document.getElementById("wingFlowImage").src
	    if (path.split('/').pop() == "wing_flow.png") {
	        document.getElementById("wingFlowImage").src = "/assets/optimizing-a-wing/wing_flow.gif";
	    } else {
	        document.getElementById("wingFlowImage").src = "/assets/optimizing-a-wing/wing_flow.png";
	    }
	}

function toggleBasicWing() {

    path = document.getElementById("basicWing").src
      if (path.split('/').pop() == "wing.png") {
          document.getElementById("basicWing").src = "/assets/optimizing-a-wing/wing_flow.gif";
      } else {
          document.getElementById("basicWing").src = "/assets/optimizing-a-wing/wing.png";
      }
  }

function hideShowAdvection() {
  var x = document.getElementById("advection_info");
  var y = document.getElementById("advection_info_toggle");
  if (x.style.display === "none") {
    x.style.display = "inline"; y.textContent = "(‚Äì)"
  } else {
    x.style.display = "none"; y.textContent = "(+)"
  }
}
function hideShowProjection() {
  var x = document.getElementById("projection_info");
  var y = document.getElementById("projection_info_toggle");
  if (x.style.display === "none") {
    x.style.display = "inline"; y.textContent = "(‚Äì)"
  } else {
    x.style.display = "none"; y.textContent = "(+)"
  }
}
function hideShowFilter() {
  var x = document.getElementById("filter_info");
  var y = document.getElementById("filter_info_toggle");
  if (x.style.display === "none") {
    x.style.display = "inline"; y.textContent = "(‚Äì)"
  } else {
    x.style.display = "none"; y.textContent = "(+)"
  }
}
function hideShowAutograd() {
  var x = document.getElementById("autograd_info");
  var y = document.getElementById("autograd_info_toggle");
  if (x.style.display === "none") {
    x.style.display = "inline"; y.textContent = "(‚Äì)"
  } else {
    x.style.display = "none"; y.textContent = "(+)"
  }
}
</script>

<script>
    function getBrowserSize(){
       var w, h;

         if(typeof window.innerWidth != 'undefined')
         {
          w = window.innerWidth; //other browsers
          h = window.innerHeight;
         } 
         else if(typeof document.documentElement != 'undefined' && typeof      document.documentElement.clientWidth != 'undefined' && document.documentElement.clientWidth != 0) 
         {
          w =  document.documentElement.clientWidth; //IE
          h = document.documentElement.clientHeight;
         }
         else{
          w = document.body.clientWidth; //IE
          h = document.body.clientHeight;
         }
       return {'width':w, 'height': h};
}

if(parseInt(getBrowserSize().width) < 600){
 document.getElementById("longEqnWithLargeScript_A").style.display = "none";
}
if(parseInt(getBrowserSize().width) > 600){
 document.getElementById("longEqnWithSmallScript_A").style.display = "none";
}
</script>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:fn1" role="doc-endnote">
      <p>Note: the code and overall approach to optimizing a wing in a fluid simulation is built on <a href="https://github.com/HIPS/autograd/blob/master/examples/fluidsim/wing.png">this Autograd example</a>.¬†<a href="#fnref:fn1" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:fn2" role="doc-endnote">
      <p>Our simulation is based on: Stam, Jos. <a href="https://drive.google.com/file/d/1upKFdtnM0xcTVxNsPHI1KCvmcanAJheL/view">Real-Time Fluid Dynamics for Games</a>. <em>Proceedings of the Game Developer Conference</em>, 2003.¬†<a href="#fnref:fn2" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:fn14" role="doc-endnote">
      <p>See <a href="https://optimization.mccormick.northwestern.edu/index.php/Wing_Shape_Optimization">this online textbook page</a> for an overview of full-scale wing optimization techniques.¬†<a href="#fnref:fn14" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:fn3" role="doc-endnote">
      <p>Jameson, Antony and Vassberg, John. <a href="https://doi.org/10.2514/6.2001-538">Computational fluid dynamics for aerodynamic design - Its current and future impact</a>, <em>American Institute of Aeronautics &amp; Astronautics</em>, 2012.¬†<a href="#fnref:fn3" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:fn4" role="doc-endnote">
      <p>Lockwood, Rowan and Swaddle, John P. and Rayner, Jeremy M. V. <a href="https://doi.org/10.2307/3677110">Avian Wingtip Shape Reconsidered: Wingtip Shape Indices and Morphological Adaptations to Migration</a>, <em>Journal of Avian Biology</em> Vol. 29, No. 3, pp. 273-292, 1998.¬†<a href="#fnref:fn4" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:fn5" role="doc-endnote">
      <p>Norberg, Ulla M. Lindhe. <a href="https://doi.org/10.1002/jmor.10013">Structure, Form, and Function of Flight in Engineering and the Living World</a>. <em>Journal of Morphology</em>, 2002.¬†<a href="#fnref:fn5" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:fn6" role="doc-endnote">
      <p>Mouret, Jean-Baptiste and Clune, Jeff. <a href="https://arxiv.org/abs/1504.04909">Illuminating search spaces by mapping elites</a>. <em>ArXiv preprint</em>, 2015.¬†<a href="#fnref:fn6" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:fn7" role="doc-endnote">
      <p>Cully, Antoine and Clune, Jeff and Taraporeand, Danesh and Mouret, Jean-Baptiste. <a href="https://www.nature.com/articles/nature14422">Robots that can adapt like animals</a>. <em>Nature</em>, 2015.¬†<a href="#fnref:fn7" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:fn8" role="doc-endnote">
      <p>Wang, Rui and Lehman, Joel and Rawal, Aditya and Zhi, Jiale and Li, Yulun and Clune, Jeff, Stanley, Kenneth O. <a href="https://arxiv.org/abs/2003.08536">Enhanced POET: Open-ended Reinforcement Learning through Unbounded Invention of Learning Challenges and their Solutions</a>. <em>International Conference on Machine Learning (ICML)</em>, 2020.¬†<a href="#fnref:fn8" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:fn15" role="doc-endnote">
      <p>Balduzzi, David, et al. <a href="https://arxiv.org/abs/1901.08106">Open-ended Learning in Symmetric Zero-sum Games</a>. arXiv preprint arXiv:1901.08106 (2019).¬†<a href="#fnref:fn15" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:fn9" role="doc-endnote">
      <p>Czarnecki, Wojciech Marian, et al. <a href="https://arxiv.org/abs/2004.09468">Real World Games Look Like Spinning Tops</a>. <em>arXiv preprint arXiv:2004.09468</em>, 2020.¬†<a href="#fnref:fn9" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:fn10" role="doc-endnote">
      <p>Vinyals, O., Babuschkin, I., Czarnecki, W.M. et al. <a href="https://doi.org/10.1038/s41586-019-1724-z">Grandmaster level in StarCraft II using multi-agent reinforcement learning</a>. Nature 575, 350‚Äì354 (2019).¬†<a href="#fnref:fn10" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:fn11" role="doc-endnote">
      <p>This is the intuition behind <a href="https://en.wikipedia.org/wiki/Emergence">emergence</a> in complexity theory. Emergence makes the most sense in the context of physics because toy examples are easy to isolate. Phil Anderson does a good job explaining a few of these examples in his article ‚Äú<a href="http://robotics.cs.tamu.edu/dshell/cs689/papers/anderson72more_is_different.pdf">More is Different</a>.‚Äù¬†<a href="#fnref:fn11" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>

  </article>

  <!-- mathjax -->
  
  <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  

  <!-- disqus comments -->
 
  <div id="disqus_thread"></div>
  <script>
      /**
       *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
       *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
       */
      /*
      var disqus_config = function () {
          this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
          this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
      };
      */
      (function() {  // DON'T EDIT BELOW THIS LINE
          var d = document, s = d.createElement('script');
          
          s.src = '//greydanus-blog.disqus.com/embed.js';
          
          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  


  
</div>
      </div>
    </div>

    <footer class="site-footer">

  <div class="wrap">

    <!-- <h2 class="footer-heading">Natural Intelligence</h2> -->

    <div class="footer-col-1 column">
      <ul>
        <li>Natural Intelligence</li>
        <!-- <li><a href="mailto:greydanus.17(at)gmail.com">greydanus.17(at)gmail.com</a></li> -->
      </ul>
    </div>

    <div class="footer-col-2 column">
      <ul>
        <li>
          <a href="https://github.com/greydanus">
            <span class="icon github">
              <svg version="1.1" class="github-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                 viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
                <path fill-rule="evenodd" clip-rule="evenodd" fill="#C2C2C2" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761
                c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32
                c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472
                c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037
                C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65
                c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261
                c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082
                c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129
                c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
              </svg>
            </span>
            <span class="username">greydanus</span>
          </a>
        </li>
        <li>
          <a href="https://twitter.com/samgreydanus">
            <span class="icon twitter">
              <svg version="1.1" class="twitter-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                 viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
                <path fill="#C2C2C2" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27
                c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767
                c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206
                C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271
                c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469
                c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
              </svg>
            </span>
            <span class="username">samgreydanus</span>
          </a>
        </li>
      </ul>
    </div>

    <div class="footer-col-3 column">
      <p class="text">A science blog by Sam Greydanus</p>
    </div>

  </div>

</footer>


    </body>
</html>